{% extends "base.html" %}
{% block title %}{{batch_data.name}} "{{batch_data.section}}" ({{batch_data.subject}}){% endblock %}

{% block content %}
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <script>
     window.onload = function() {
        var messages = {{ messages | safe }};
        for (var i=0; i<messages.length; i++) {
            alert(messages[i]);
        }
      }
    </script>
  {% endif %}
{% endwith %}


<div class="row full-page-container">
    <div class="col-sm-8">
        <div id="msg-display">
        <ul>
            {% for msg in batch_data.messages|reverse %}
                <li>
                    {% if msg.type == 'text' %}
                        <div class="card bg-dark text-message-memo">
                            <div class="card-body">
                                <b style="margin-top:-2px;" class="text-white">{{msg.sender}}</b>
                                <p style="margin-bottom:-1px;margin-top:10px;" class="text-white">{{msg.value}}</p>
                            </div>
                        </div>
                    {% else %}
                        <div class="card bg-dark text-message-memo">
                            <div class="card-body">
                                <div class="card-details">
                                    <h5 style="margin-top:-2px;" class="text-white">{{msg.value[0]}}</h5>
                                    <p style="margin-bottom:-1px;margin-top:10px;" class="text-white">Sent by: {{msg.sender}}</p>
                                </div>
                                <div class="file-action-btn" id="file-action-btn">
                                    <a class="btn btn-secondary text-white" href="{{msg.value[1]}}" target="_blank">Download</a>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <br>
                </li>
            {% endfor %}
        </ul>
    </div>
    {% if cat == 'teacher' %}
        <div class="card bg-dark">
            <div class="card-body">
                <div id="msg-send">
                    <label class="text-white" for="file-type">Choose Message type:</label>
                    <select class="form-control mr-sm-2" name="msg-type" id="msg-type" required>
                        <option value="Text">Text</option>
                        <option value="File Upload">File Upload</option>
                    </select>
                    <form class="form-inline"  id="send-text-message-form" action="{{url_for('send_msg')}}" method="POST">
                        <input class="form-control" id="send-text-msg-input" type="text" name="msg" placeholder="Enter message..." autocomplete="off" required>
                        <input class="btn btn-secondary" type="submit" value="Send">
                    </form>
                    <form class="form-inline"  id="send-attach-message-form" action="{{url_for('send_attachment')}}" enctype="multipart/form-data" method="POST">
                        <input class="form-control mr-sm-2" id="topic-input-memos" type="text" name="topic" placeholder="Topic" autocomplete="off" required>
                        <input class="form-control-file text-white" id="file-input-memos" type="file" name="file" autocomplete="off" required>
                        <input class="btn btn-secondary btn-block" style="margin-top:7px;" type="submit" value="Send">
                    </form>
                </div>
            </div>
        </div>
        <script>
            msg_type_selection = document.getElementById('msg-type')
            msg_type_selection.onchange = function() {
                if (msg_type_selection.value == "File Upload") {
                    document.getElementById("send-text-message-form").style.display = 'none';
                    document.getElementById("send-attach-message-form").style.display = 'inline';
                } else {
                     document.getElementById("send-text-message-form").style.display = 'inline';
                    document.getElementById("send-attach-message-form").style.display = 'none';
                }
            }
        </script>
    {% endif %}
    </div>

    {% if cat == 'teacher' %}
        <div class="col-sm-4" id="invitation-box">
            <div class="card bg-dark">
                <div class="card-body">
                    <h4 id="invitation-title" class="card-title text-white">Add students/teachers to this Batch</h4>
                    <form class="form-inline" action="{{url_for('invite')}}" method="POST">
                        <input class="form-control mr-sm-2" id="email-memos" type="email" name="email" placeholder="Email" autocomplete="off">
                        <input class="btn btn-secondary" id="email-submit-btn-memos" type="submit" value="Add to Batch">
                    </form>
                    {% if error_msg %}
                        <br>
                        <p class="alert alert-warning alert-dismissible">{{error_msg}}</p>
                    {% endif %}
                    <br>
                    <div id="participants">
                        <ol>
                            {% for participant in batch_data.participants %}
                                <li class="text-white">{{participant}}</li>
                            {% endfor %}
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
